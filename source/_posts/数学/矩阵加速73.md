---
title: 矩阵加速
categories:
  - 数学
mathjax: true
abbrlink: 44414
tags:
 - 矩阵
 - 数论
 - 专题
date: 2018-10-03 11:10:00
updated: 2018-10-03 11:10:00
---
## 简介

- 矩阵加速，用于计算数列的第n项（当n的数值过大，线性算法超时时）。
- 这里的数列限指`K阶常系数线性递推式`<!--more-->

## 原理

**矩阵快速幂**

大致分三步：
- 将原式化为矩阵
- 矩阵乘法分离，建立**矩阵递推关系**
- 找到起始项，建立常数矩阵幂关系（可用数学归纳法证明）

## K阶常系数线性递推关系
$$F_n=a_1*F_{n-1}+a_2*F_{n-2}+\cdots +a_k*F_{n-k}$$

## 典例

### Fibonacci第n项
- 考虑以下的递推式
$$f_n=f_{n-1}*1+f_{n-2}*1 \\ f_{n-1}=f_{n-1}*1+f[n-2]*0$$

- 以此先构建关于$f_n$递推式的一维矩阵： 
$$
\begin{bmatrix}
f_n \\
f_{n-1}
\end{bmatrix}
$$

构建一个常数矩阵将$f_n$的矩阵与$f_{n-1}$的矩阵建立**矩阵递推式**：

$$
\begin{bmatrix} 
f_n \\
f_{n-1}
\end{bmatrix}

=
\begin{bmatrix} 
1 &1 \\
1 &0
\end{bmatrix}
*
\begin{bmatrix} 
f_{n-1} \\
f_{n-2}
\end{bmatrix}
$$

根据$f_1,f_2$的值，转化为**常数矩阵幂**计算：

$$
\begin{bmatrix} 
f_n \\
f_{n-1}
\end{bmatrix}

=
\begin{bmatrix} 
1 &1 \\
1 &0
\end{bmatrix}
^{n-2}*
\begin{bmatrix} 
f_{2} \\
f_{1}
\end{bmatrix}
$$

然后，快速幂计算，复杂度$O(log_2n)$

### LuoguP1939
考虑
$$a_n=a_{n-1}*1+a_{n-2}*0+a_{n-3}*1 \\ a_{n-1}=a_{n-1}*1+a_{n-2}*0+a_{n-3}*0 \\ a_{n-2}=a_{n-1}*0+a_{n-2}*1+a_{n-3}*0 \\$$

矩阵乘法分离取幂
$$
\begin{bmatrix} 
a_n \\
a_{n-1} \\
a_{n-2}
\end{bmatrix}

=
\begin{bmatrix} 
1 &0 &1 \\
1 &0 &0 \\
0 &1 &0
\end{bmatrix}
*
\begin{bmatrix} 
a_{n-1} \\
a_{n-2} \\
a_{n-3}
\end{bmatrix}
=
\begin{bmatrix} 
1 &0 &1 \\
1 &0 &0 \\
0 &1 &0
\end{bmatrix}
^{n-3}*
\begin{bmatrix} 
a_{3} \\
a_{2} \\
a_{1}
\end{bmatrix}
$$

然后，快速幂即可