---
title: 概率期望小结
categories:
  - 数学
mathjax: true
abbrlink: 57182
date: 2019-02-13 08:38:22
updated: 2019-02-13 16:43:22
tags:
---


**摘要**

Tqy 奆奆给我们讲概率啦


<!--more-->

# 概率与期望

## 概率空间

三元组 $(\Omega,F,P)$. 被称为概率空间：

1. 样本空间 $\Omega$ 是一个非空集合
2. 集合 $F$ 的元素是 $\Omega$ 的子集，$F$ 是样本空间 $\Omega$ 的幂集的非空子集，即 $F\subseteq2^\Omega$.
3. 概率测度 $P:F\rightarrow[0,1]$ 满足
    - $P(\Omega)=1$.
    - $\forall A,B\in \Omega,A\cap B=\varnothing ,\Rightarrow P(A\cup B)=P(A)+P(B)$.

## 条件概率


定义在 B 条件下 A 的概率为，在事件 B 发生时事件 A 发生的概率
$$
\frac{P(A\cap B)}{P(B)}
$$
简记为
$$
P(A|B)
$$
## 全概率公式

若 $B_{1\cdots n}$ 是 $\Omega$ 的一个划分，且 $B_i\in F$，则有
$$
P(A)=\sum_{i=1}^nP(A\cap B_i)=\sum_{i=1}^nP(A|B_i)P(B_i)
$$

## 贝叶斯公式

对于满足 $P(B)\neq 0$ 的 $A,B,\in F$, 有
$$
P(A|B)=\frac{P(B|A)P(A)}{P(B)}
$$

推论：$A_k$ 为一个划分
$$
P(A_k)=\frac{P(B|A_k)P(A_k)}{\sum_{I=1}^nP(B|A_i)P(A_i)}
$$

## 随机变量

一个随机变量是一个从样本空间 $\Omega$ 到一个可测空间 $E$ 的一个函数 $X : \Omega \rightarrow E$。一般而言 $E = R$。

若对于两个随机变量 $X$ 和 $Y$, 有

$$
P(X = x \wedge  Y = y) = P(X = x)P(Y = y)
$$

则称 X 和 Y 是独立的。

## 期望

一个随机变量的数学期望或是均值定义为它取值的平均值：
$$
E(X)=\sum_{\omega\in \Omega}P(\omega)X(\omega)=\sum_xx\cdot P(X=x)
$$

### 期望的线性性

$$
E(X+Y)=E(X)+E(Y)
$$

对于常数 $c$，
$$
E(cX)=cE(X)
$$
对于两个独立随机变量 X 和 Y, 有
$$
E(XY)=E(X)E(Y)
$$
快速排序期望比较次数
$$
\begin{split}
T(n)=&\frac{1}{n}\sum_{i=0}^{n-1}(T(i)+T(n-i-1))+n-1\\
T(n)=&\frac{2}{n}\sum_{i=0}^{n-1}T(i)+(n-1)\\
nT(n)=&2\sum_{i=0}^{n-1}T(i)+n(n-1)\\
(n-1)T(n-1)=&2\sum_{i=0}^{n-2}T(i)+(n-1)(n-2)\\
nT(n)-(n-1)T(n-1)=&2T(n-1)+2(n-1)\\
nT(n)-nT(n-1)=&T(n-1)+2(n-1)\\
T(n)-T(n-1)=&\frac{T(n-1)+2(n-1)}{n}\\
T(n)=&\frac{n+1}{n}T(n-1)+\frac{2n-2}{n}\\
\end{split}
$$

### 方差

随机变量 X 的方差定义为
$$
V(X)=E\left((X-E(X))^2 \right)\\
V(X)=E\left(X^2-2XE(X)+E^2(X) \right)\\
=E(X^2)-2E(X)E(X)+E^2(x)=E(X^2)-E^2(x)
$$
因为常量的期望是其本身，所以 $E(E^2(x))=E^2(x)$.

## 概率生成函数

对于一个随机变量 $X : \Omega \rightarrow \mathbb{N}$, 定义其概率生成函数 (pgf) 为
$$
F_X(z)=E(X^z)=\sum_{i=0}^\infty P(X=i)z^i
$$

# 小练习 1

> 给定一个从 S 到 T 的 DAG, 每到一个点会从所有出边中等概率选一条边走过去，求从 S 到 T 的期望路径长度。

倒着期望 DP，$DP[i]$ 表示从 $i$ 到 $T$ 的期望路径长度
$$
dp[i]=\frac{1}{k}\sum_{i=1}^k(dp[v_i]+1)=1+\frac{1}{k}\sum_{i=1}^kdp[v_i]
$$

复杂度 $\Theta(n)$.

# 小练习 2

> 有 n 块布，每次从中等概率随机选一个染色，求所有布都被染色所需的期望染色次数。

$f[i]$ 表示还剩 $i$ 块布没染，染完的期望次数
$$
f[i]=\frac{i}{n}f[i-1]+\frac{n-i}{n}f[i]+1\\
f[i]=f[i-1]+\frac{n}{i}
$$

复杂度 $\Theta(n)$.

# [BZOJ4318]OSU!

> 有一个长度为 $n$ 的序列，第 $i$ 个位置有 $p_i$ 的概率为 $1$,$1-p_i$ 的概率为 $0$, 一个序列的分数是所有极长连续 $1$ 的长度的三次方和。求期望分数。

我们不妨先考虑贡献 $X$ 的分数的情况

那么定义 $f_1[i]$ 表示第 $i$ 个数结尾的极大 1 串的**期望贡献**，显然
$$
f_1[i]=(f_i[i-1]+1)p_i
$$
注意，是第 i 个数的期望贡献，其贡献与前一个数结尾的极大 1 串的贡献有关

再考虑 $X^2$ 的分数的情况

注意到 $(X+1)^2=X^2+2X+1$，那么定义 $f_2[i]$ 表示第 $i$ 个数结尾的极大 1 串的**期望贡献**，
$$
f_2[i]=(f_2[i-1]+2f_1[i-1]+1)p_i.
$$
再考虑 $X^3$ 的分数的情况
$$
(X+1)^3=X^3+3X^2+3X+1\\
f_3[i]=(f_3[i-1]+3f_2[i-1]+3f_1[i-1]+1)p_i.
$$
所以我们的答案怎么统计呢？你发现了，这样的递推式是关于第 $i$ 个数结尾的极大 1 串的，却不是关于第 $i$ 个数的贡献。因此我们尝试在这个递推式中分离出第 $i$ 个数的贡献。显而易见，第 $i$ 个数的贡献是
$$
(3f_2[i-1]+3f_1[i-1]+1)p_i
$$
至于 $f_3[i-1]\cdot p_i$ 表示的是上一个期望对这一次的贡献，不属于第 $i$ 个数的贡献

那么答案即为
$$
\sum_{i=1}^n(3f_2[i-1]+3f_1[i-1]+1)p_i
$$

```cpp
#include<cstdio>
using namespace std;
const int N=1e5+5;
int n;
double p[N];
double f1[N],f2[N],ans;

int main(){scanf("%d",&n);
	for(int i=1;i<=n;i++)scanf("%lf",&p[i]);
	for(int i=1;i<=n;i++)f1[i]=p[i]*(f1[i-1]+1),
    	f2[i]=p[i]*(f2[i-1]+2*f1[i-1]+1),ans+=p[i]*(3*f2[i-1]+3*f1[i-1]+1);
	printf("%.1lf",ans);
	return 0;
}

```

复杂度 $\Theta(n)$.

# [BZOJ3270] 博物馆

> 给定一个 n 个点 m 条边的无向图，有两个人分别从 A 和 B 出发在图中随机游走。每个人都遵循规则：如果当前在点 u 则在当前时间他有 $p_u$ 的概率呆在 u 不动，有 $1-p_u$ 的等概率在所有相邻点中选择一个走过去。问两个人走到同一个点所需要的期望时间。$n \leq 20$.

我们考虑两个人的位置，$f[i,j]$ 表示 A 在 i，B 在 j 时，他们走到一起的期望时间
$$
\begin{split}
f[i,j]=&p_ip_jf[i,j]\\
&+p_i(1-p_j)\cdot\frac{\sum_{(j,y)\in E}f[i,y]}{d[j]}\\
&+(1-p_i)p_j\cdot\frac{\sum_{(i,x)\in E}f[x,j]}{d[i]}\\
&+(1-p_i)(1-p_j)\cdot \frac{\sum_{(i,x)\in E}\sum_{(j,y)\in E}f[x,y]}{d[i]d[j]}\\
\end{split}
$$
由于 $n\leq 20$，那么 $f$ 一共最多有 $n^2$ 项，那么对这个式子做一次高斯消元，复杂度 $\Theta(n^6)$.

# 构造

考虑一条链的情况


$$
f[i]=\frac{1}{2}(f[i-1]+f[i+1])+1,f[n]=0\\
f[i+1]-f[i]=f[i]-f[i-1]+2\\
f[1]=f[2]+1\\
f[1]-f[2]=1\\
f[2]-f[3]=3\\
f=n^2
$$

那么前面构造一个团，后面一条链，两者点数对半开，
$$
\frac{1}{n}
$$
一个点数为 n 的团的路径长度期望为 $n$.

那么总期望
$$
\frac{n^3}{8}=\frac{n}{2}\cdot\frac{n^2}{4}
$$

# 题

咕咕

AC 自动机上期望 dp

转移的时候局部高斯消元，整体 DAGDP

# SRM614

考虑边界点

模型

在一个分层循环 DAG 上游走，那么在某一层破环为链，转化为线性的期望 DP

# HDU4035

树形 dp,
$$
f[i]=k_idp[1]+\frac{1-k_i-e_i}{d_i}\sum f[v]+1-e_i\\
f[i]=k_idp[1]+(1-k_i-e_i)\sum f[fa]+1-e_i
$$

对于叶结点，递归向上维护 abc
那么由子结点的 abc 维护当前结点的 abc 就可以只 dfs 维护 abc 即可

# LOJ2125

考虑最后一个 1（需要翻转的位置），这个位置必翻转其本身

假设 P1,p2,,pk 需要翻转，这是指一个翻转方案，已经保证了答案的正确性

那我们就要求这些位置翻转奇数次，其他位置翻转偶数次

那么我们维护仍需要翻转的个数，dp[i] 表示仍需要翻转 i 次的期望次数
$$
dp[i]=\frac{i}{n}dp[i-1]+\frac{n-i}{n}dp[i+1]+1
$$
注意　我们维护的是翻转方案序列，已经保证了答案的正确性

# 小练习 3

做异或差分，$d_i=a_i\oplus a_{i-1}$，那么区间翻转（区间异或）转化为端点异或，那么就可以向之前一样 DP 啦

# CTSC2017

当前的胜率只和前后的确定位置（结果）有关
$$
P(x_m=1|x_l\cap x_r)\\
P(x_l\cap x_r|x_m=1)P(x_m=1)\\
\frac{P(x_m=1\cap x_r|x_l)}{P(x_r|x_l)}\\
\frac{P(x_m=1|x_l)P(x_r|x_m=1)}{P(x_r|x_l)}=P(x_m=1)
$$

概率矩阵乘法

# 小练习 4

根据期望的线性性，我们求经过每一条边的期望次数再求和即可
$$
P(u,v)=\frac{2SZ_uSZ_v}{n^2}
$$
两边的子树随机选，然后就可以算出经过一条边的概率，即期望次数
