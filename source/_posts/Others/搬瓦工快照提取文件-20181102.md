---
title: 搬瓦工快照提取文件
tags:
 - DISK
categories:
  - Others
abbrlink: 38548
date: 2018-11-02 13:18:31
updated: 2018-11-02 13:18:31
---

搬瓦工的快照文件是一个 `tar.gz` 的压缩包，如何提取里面的文件？

方法是将里面 raw 格式镜像（`disk` 文件）通过 kpartx 挂载在 linux 文件夹下

建议先开启 root 权限：

```
sudo su
```

解压（必须用 linux 下的 tar）：

```
tar -zxvf snapshot-******.tar.gz
```

安装 kpartx

```
apt install kpartx
```

查看空闲设备

```
losetup -f   #查看哪个 loop 设备是空闲的
```
```
#输出
/dev/loopX      #loopX 这个设备是空闲的
```

挂载

```
losetup /dev/loop0 vm-**.disk
kpartx -av /dev/loop0
```
```
#输出
add map loop0pX *****
add map loop0pY *****
add map loop0pZ *****
```

这些就是 disk 文件中的各个分区

然后查看你想要的在哪个分区，比如我的数据在 loop0pX

```
#把 loop0p2 挂载到 /mnt
mount /dev/mapper/loop0pX /mnt
```

就可在 /mnt 里找到相关数据了

数据复制完成后记得卸载镜像：

```
umount /mnt
kpartx -dv /dev/loopX
losetup -d /dev/loopX
```



## 参考

[经验 - 从搬瓦工快照中提取相关文件](https://www.hostloc.com/thread-392553-1-1.html)