title: Aria2 使用指北
mathjax: true
abbrlink: 53687
categories:
  - Others
date: 2019-04-13 22:01:23
updated: 2019-04-13 22:01:23
tags:
keywords:
---


**摘要**

aria2 对于普通用户可能并没有那么友好，不过在进行配置后，它将是真正的开源免费下载利器！对于那些不了解 aria2 的同学，笔者就本文章介绍一下 aria2 在 linux 下的使用


<!--more-->

# 被遗弃的 Windows？

aria2 并不是 linux 专属，只不过关于 windows 的配置教程较多，并且那些教程通常都是包含 aria2 图形界面的配置，容易上手。而在 linux 这个方面，由于默认了大多数 linux 是习惯使用命令行的，因此对于图形界面的配置教程相对较少。于是就有了这篇文章

# Aria2 命令行与 GUI

首先，下载一个 aria2 命令行界面是很有必要的。一方面，使用 linux 系统的用户或多或少都会接触命令的运行，再者，使用命令行界面相比图形界面有更高的定制化空间，也可以提高效率；其次，任何软件的图形界面本质上就是在运行一系列的命令，因此装一个命令行界面也是理所当然的事情

## Ubuntu

直接从源里添加

```
sudo apt-get install aria2
```

还有一个图形界面的软件，见 Manjaro 的部分

## Manjaro/Arch

当然是我大 pacman，这个估计大家都会的，毕竟选择 Arch 系列的都是能折腾的人

不过笔者使用 yaourt 又多安装了一个软件，用于图形界面

```
[sshwy@sshwy-pc ~]$ yaourt aria2
1 community/aria2 1.34.0-2
    Download utility that supports HTTP(S), FTP, BitTorrent, and Metalink
2 archlinuxcn/aria2-fast 1.34.0-2
    Aria2 Download utility with little patch to maximize aria2 download speed
3 archlinuxcn/ariang-allinone 1.0.2-3
    AriaNg, a modern web frontend making aria2 easier to use. (all-in-one version)
curl error: URL using bad/illegal format or missing URL
==> 输入 n° 以安装需要的软件包（例如：1 2 3 或者是 1-3）
==> ---------------------------------
==>
```

我们选择 2 和 3 安装，毕竟人家都写了一个 fast 嘛。ubuntu 同理。不过不得不说，ubuntu 的软件源实在难用，这也是笔者从 deepin 切换到 Manjaro deepin 的原因

## 命令行的使用

笔者只提醒一点，这个命令的名字不是 aria2，是 aria2c。其余的自己百度吧

# 图形界面的配置

对于喜欢倒腾的小伙伴估计尝试过运行 ariang-allinone 了。命令行输入该命令后，会在浏览器里弹出一个标签页，也就是漂亮的图形界面啦

![pic](https://hexo-source-1257756441.cos.ap-chengdu.myqcloud.com/2019/04/13/2322.png)

不过注意到，Aria2 的状态是未连接。为什么？是因为我们并没有启动 aria2 命令行的端口监听。

## Aria2 配置文件

首先我们创建 aria2 的配置文件，在 `/etc/` 新建目录 `aria2/`，并建立 `aria2.conf` 和 `aria2.session` 文件

```bash
sudo mkdir /etc/aria2/
sudo touch /etc/aria2/aria2.conf
sudo touch /etc/aria2/aria2.session
sudo chmod 777 /etc/aria2/aria2.session
```

然后编辑 `aria2.conf` 文件，加入以下配置，当然是可以在此配置的基础上自定义的

```bash
dir=/home/zz/
disable-ipv6=true
#断点续传
continue=true
input-file=/etc/aria2/aria2.session
save-session=/etc/aria2/aria2.session
# 启用磁盘缓存，0 为禁用缓存，需 1.16 以上版本，默认：16M
disk-cache=32M
# 文件预分配方式，能有效降低磁盘碎片，默认：prealloc
# 预分配所需时间：none < falloc ? trunc < prealloc
# falloc 和 trunc 则需要文件系统和内核支持，NTFS 建议使用 falloc, EXT3/4 建议 trunc
file-allocation=trunc
# 断点续传
continue=true
# 最大同时下载任务数，运行时可修改，默认：5
max-concurrent-downloads=5
# 同一服务器连接数，添加时可指定，默认：1
max-connection-per-server=5
# 最小文件分片大小，添加时可指定，取值范围 1M -1024M, 默认：20M
# 假定 size=10M, 文件为 20MiB 则使用两个来源下载；文件为 15MiB 则使用一个来源下载
min-split-size=10M
# 单个任务最大线程数，添加时可指定，默认：5
split=64
# 整体下载速度限制，运行时可修改，默认：0
#max-overall-download-limit=0
# 单个任务下载速度限制，默认：0
#max-download-limit=0
# 整体上传速度限制，运行时可修改，默认：0
#max-overall-upload-limit=0
# 单个任务上传速度限制，默认：0
#max-upload-limit=0
# 禁用 IPv6, 默认：false
disable-ipv6=true
## 进度保存相关 ##
# 从会话文件中读取下载任务
input-file=aria2.session
# 在 Aria2 退出时保存 ` 错误 / 未完成 ` 的下载任务到会话文件
save-session=aria2.session
# 定时保存会话，0 为退出时才保存，需 1.16.1 以上版本，默认：0
save-session-interval=60
## RPC 相关设置 ##
enable-rpc=true
# 允许所有来源，默认：false
rpc-allow-origin-all=true
# 允许非外部访问，默认：false
rpc-listen-all=true
# 事件轮询方式，取值：[epoll, kqueue, port, poll, select], 不同系统默认值不同
#event-poll=select
# RPC 监听端口，端口被占用时可以修改，默认：6800
#rpc-listen-port=6800
## BT/PT 下载相关 ##
# 当下载的是一个种子（以.torrent 结尾）时，自动开始 BT 任务，默认：true
#follow-torrent=true
# BT 监听端口，当端口被屏蔽时使用，默认：6881-6999
listen-port=51413
# 单个种子最大连接数，默认：55
#bt-max-peers=55
# 打开 DHT 功能，PT 需要禁用，默认：true
enable-dht=false
# 打开 IPv6 DHT 功能，PT 需要禁用
#enable-dht6=false
# DHT 网络监听端口，默认：6881-6999
#dht-listen-port=6881-6999
# 本地结点查找，PT 需要禁用，默认：false
#bt-enable-lpd=false
# 种子交换，PT 需要禁用，默认：true
enable-peer-exchange=false
# 每个种子限速，对少种的 PT 很有用，默认：50K
#bt-request-peer-speed-limit=50K
# 客户端伪装，PT 需要
peer-id-prefix=-TR2770-
user-agent=Transmission/2.77
# 当种子的分享率达到这个数时，自动停止做种，0 为一直做种，默认：1.0
seed-ratio=0
# 强制保存会话，话即使任务已经完成，默认：false
# 较新的版本开启后会在任务完成后依然保留.aria2 文件
#force-save=false
# BT 校验相关，默认：true
#bt-hash-check-seed=true
# 继续之前的 BT 任务时，无需再次校验，默认：false
bt-seed-unverified=true
# 保存磁力链接元数据为种子文件 (.torrent 文件）, 默认：false
bt-save-metadata=true
```

## 启动监听

运行以下命令

```bash
sudo aria2c --conf-path=/etc/aria2/aria2.conf
```

如果运行成功，就会输出正在监听 XX 端口（通常是 6800）

如果跳出什么无法打开 `aria2.session` 的错误，就在当前运行命令的目录下建一个 `aria2.session` 文件。这是笔者遇到过的问题

运行以后再打开图形界面，就会变成已连接啦。图形界面有中文，大部分参数有解释，是不是很良心～

另外，这个 WebUI 与命令行是分开的，因此即使你关闭了 WebUI，只要不终止命令，那么下载将继续运行；你可以过一会儿重新启动 WebUI，仍可以看到正在下载的文件。（这个 WebUI 是一个 html 文件，甚至可以加到 chrome 的收藏里，从 chrome 启动，不用从命令行启动啦，不过 aria2 的监听仍然要通过命令启动，可以吧这个命令写到一个 sh 文件里，下次直接运行这个文件，就不用去背这么长的命令了）

# Extra-P 站下载插画

由于 P 站设置了防倒链使得爬虫爬下来的链接用 aria2 下载会 403 报错，解决方法就是设置 referer 为 `http://www.pixiv.net`，在 HTTP 设置的请求来源选项里

