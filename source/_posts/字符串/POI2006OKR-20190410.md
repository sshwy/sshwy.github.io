---
title: '[POI2006]OKR-Periods of Words'
mathjax: true
categories:
  - 字符串
keywords: 'KMP, border'
abbrlink: 42520
date: 2019-04-10 08:00:12
updated: 2019-04-10 08:00:12
tags:
 - POI
---


**摘要**

题意：求一个串所有前缀的最长周期之和。这里的周期是非严格周期，不能为自身


<!--more-->

即求最短border，那么$i-border$就是最长周期。注意到$KMP$的$Next$数组求的是最长$border$，而$Next$数组呈树形结构，因此循环一遍直接更新$Next$为最短$border$即可

要开ll

```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int N=1e6+6;
int n;
char s[N];

namespace KMP{
	int nex[N];
	void getnext(char *s,int ls){
		nex[1]=0;
		for(int i=2,j=0;i<=ls;i++){
			while(j&&s[i]!=s[j+1])j=nex[j];
			if(s[i]==s[j+1])++j;
			nex[i]=j;
		}
	}
	int calc(char *s,int ls){
		int res=0;
		getnext(s,ls);
		//最小化next
		for(int i=1;i<=ls;i++){
			if(!nex[i])continue;
			if(nex[nex[i]])nex[i]=nex[nex[i]];
			res+=i-nex[i];
		}
		return res;
	}
}
signed main(){
	scanf("%lld%s",&n,s+1);
	int ls=strlen(s+1);
	printf("%lld",KMP::calc(s,ls));
	return 0;
}

```

