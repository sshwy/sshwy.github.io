---
title: 镇海省选集训Day1
mathjax: true
abbrlink: 29376
categories:
  - 比赛
date: 2019-03-17 08:59:30
updated: 2019-03-18 21:07:30
tags:
---


**摘要**

镇海中学的都是神仙吧


<!--more-->

# A.Line

> 平面上有n条两两不同的直线$y=a_ix+b_i$，现在给出一个左下角为$(x_1,y_1)$右上角为$(x_2,y_2)$的矩形，问有多少个直线对$(i,j)(i<j)$满足$i$和$j$的交点在矩形内（含边界）

算法1：暴力判断两两直线的交点位置，复杂度$O(n^2)$.

考虑把在矩形外面的直线都忽略，只考虑与矩形相交的直线，这些直线会把矩形的周长分为两个部分；考虑两条相交的直线，这两条直线各自对应的部分也相交（随便各取一个部分都是相交的）.因此我们断环为链，那么每个直线分割出的部分可以用**一个**唯一的区间表示，两个相交的直线对应的区间也相交

![相交区间](https://hexo-source-1257756441.cos.ap-chengdu.myqcloud.com/2019/03/18/2102.png)

因此问题转化为$n$个闭区间$[L_i,R_i]$中，相交区间的对数.把区间端点当作二维坐标，就是一个二维数点的问题.对于两个区间$(a,b),(c,d)$，如果$a\leq c\leq b\leq d$，那么两者相交.也就是在确定$(a,b)$的情况下在一个矩形内数点.采用离线算法，树状数组维护即可.

# B.Equation

> 多组数据，给出整数$n,K$，问存在多少有序二元组$(a,b)(0\leq a,b<n)$满足
> $$
> \exists x,y\in\mathbb{Z},\left\{\begin{split}
> &x^2+y^2\equiv a(\bmod m)\\
> &xy\equiv b(\bmod m)
> \end{split}\right..
> $$
> 答案对$K​$取模.
>
> $n\leq 10^{18},T\leq 100$.

设答案关于$n$的函数为$f(n)$.可知答案是积性的（据说是中国剩余定理的推论），即当$gcd(n,m)=1$时，有$f(nm)=f(n)f(m)$.

因此考虑将$n$分解质因数.

对于$n\leq 10^{12}$的情况，可以$\sqrt n$分解；而对于$n\leq 10^{18}$的情况使用Pollard-Rho 质因数分解~~（先咕着）~~

于是我们只需要考虑去求$f(p^a)$即可，其中$p$为质数.

## $p$为奇质数

要找一个$(a,b)​$，相当于找一个$(x^2+y^2,xy)​$.而后者与$\left((x+y)^2,(x-y)^2\right)​$是等价的.因为

$$
x^2\pm 2xy+y^2=(x\pm y)^2​
$$

那么就可以使用代数变换来在两者之间转换，换言之两者构成双射.

因此我们设$\alpha=(x+y)^2,\beta=(x-y)^2$.我们要找的就是$(\alpha,\beta)$的有序二元组.那么$\alpha,\beta$显然是二次剩余.因为$p^a$是奇数，所以2有逆元，所以在模意义下可以进行除以2的运算；因此只要找到二次剩余对应的根，就能保证$x,y$有整数解.因此我们考虑求$\bmod p^a$意义下的二次剩余的个数

当$a=1$时，也就是在$\bmod p$意义下，二次剩余的两个根的奇偶性不同.二次剩余的个数为$\frac{p-1}{2}$；

考虑$\bmod p^a$意义下，所有的数可以表示为$i\times p^j$的形式.若$i\times p^j$是二次剩余，那么$j$一定为偶数，即$i\times p^{2j}$的形式的数才可能是二次剩余.推一推式子，就可以发现这样的二次剩余的个数为
$$
\frac{1}{2}\varphi\left(p^{2j-a}\right)
$$
那么对每一个$j$如是计算求和，就可以得到$\bmod p^a$意义下二次剩余的个数.

求得了个数$cnt$，那么对答案的贡献就是$cnt^2$.（有序数对，乘法原理）

## $p$为2

这个时候，我们的二次剩余不能保证$x,y$有整数解（因为没有2的逆元）

考虑暴力打表，我们打出$f\left(2^i\right),i\leq 60$的表即可.鉴于笔者并没有完全听懂标程的算法，这里简单口糊一下

先打出$i$比较小的情况下的解，例如$i\leq 10$的函数值可以暴力$O(n^2)$算.然后得到答案序列$a_0,a_1,\cdots,a_n$.这样的序列通常有一个递推的式子形如
$$
a_n=\sum_{i=1}^{n-1} b_ia_{n-i}
$$
因此我们想办法求出这个$b$序列的前几项，用高斯消元做，然后找到$b$序列的规律之类的来得到整个$b$序列，然后就可以递推算$a$序列了

# C.Bridge

> 在无向图$G=(V,E)$中，定义桥为点的三元组$(i,j,k)$满足$(i,j),(j,k)\in E,(i,k)\notin E$.
>
> 求带标号的$n$个点，至多有$K$个桥的无向图（不要求联通）的个数，答案对$m$取模
>
> $m\leq 10^9+7,1\leq n\leq 5000,0\leq K\leq 8$.

这道题的范围比较吓人，需要去猜一个结论

考虑$n$个点的联通图有$m$个桥时：

- 当$m=0$时，意味着任意两个点都相邻，因此图是一个团.
- 当$m>0$时，一定满足$m\geq n-2$.

这个结论放在最后证明.我们考虑在此基础上的算法过程.既然桥最多只有$8$个，那么点最多就只有$10$个，于是我们可以设$f[i,j]$表示$i$个点有$j$个桥的联通图个数，把这个表打出来存到数组里，然后跑一个二维的DP就做完了.

## DP

定义$g[i,j]$表示$i$个点有$j$个桥的无向图（不要求联通）的个数，在DP的时候相当于每次加一个$f[i,j]$或者加一个团上去，标号用组合数算即可

## 打表

对于求$f[i,j]$的过程，没什么思维，直接暴搜，做一些能做的剪枝（桥数>k就break），位运算优化一下，用并查集判连通性.据说标程打下来都花了10分钟

## 结论的证明

证明一下$m>0$的情况

假设对于一个$n$个点的联通图，我们要判断它的桥的个数，我们模拟这个图的构建过程，假设我们往这个图逐渐加点，每加一个点，就把和这个点相邻的边连起来.假设加了前$i-1$个点后，这个图有一个桥$(a,b,c)$.

我们假设增加第$i$个点后，桥的个数不会增加.那么考虑存在$(i,j),(j,k)\in E$，因为不增加桥，所以$(i,k)\in E$.以此类推，所的点，都要与$i$有连边，否则桥的个数就会增加.这时考虑桥$(a,b,c)$，$(i,a),(i,c)\in E$，但$(a,c)\notin E$，因此$(a,i,c)$会构成一个桥，与假设矛盾.

也就是说，只要这个图在当前状态下有桥，那么每加一个点，就会增加至少一个桥.于是对于$m>0$的情况，我们在模拟构建过程的时候，优先选择三个点构成一个桥，那么随后增加的点都会形成至少一个桥，于是$m\geq n-2$.

证毕.